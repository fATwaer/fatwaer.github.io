<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="generator" content="Hugo 0.79.0" />

  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="author" content="pwaer" />
  <meta property="og:url" content="https://pwaer.ink/blog/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/6-828-%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%E5%B7%A5%E7%A8%8B-lab3-user-environments/" />
  <link rel="canonical" href="https://pwaer.ink/blog/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/6-828-%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%E5%B7%A5%E7%A8%8B-lab3-user-environments/" /><link rel="alternate" type="application/atom+xml" href="https://pwaer.ink/index.xml" title="Pwaer&#39;s Blog">

  <script type="application/ld+json">
  {
      "@context" : "http://schema.org",
      "@type" : "BlogPosting",
      "mainEntityOfPage": {
           "@type": "WebPage",
           "@id": "https:\/\/pwaer.ink\/"
      },
      "articleSection" : "blog",
      "name" : "6.828-操作系统工程-Lab3:User Environments",
      "headline" : "6.828-操作系统工程-Lab3:User Environments",
      "description" : "4月22日 - 5月2日\n PART A 这章的练习将会取实现一些基础的用户模式下的环境，也就是进程。在这章，创建一个用户环境，读取程序镜像并且运行。 这是关于这章节代码文件的介绍\ninc\/env.h Public definitions for user-mode environments trap.h Public definitions for trap handling syscall.h Public definitions for system calls from user environments to the kernel lib.h Public definitions for the user-mode support library kern\/env.h Kernel-private definitions for user-mode environments env.c Kernel code implementing user-mode environments trap.h Kernel-private trap handling definitions trap.c Trap handling code trapentry.S Assembly-language trap handler entry-points syscall.h Kernel-private definitions for system call handling syscall.",
      "inLanguage" : "en-US",
      "author" : "pwaer",
      "creator" : "pwaer",
      "publisher": "pwaer",
      "accountablePerson" : "pwaer",
      "copyrightHolder" : "pwaer",
      "copyrightYear" : "2018",
      "datePublished": "2018-04-22 23:01:09 \u002b0000 UTC",
      "dateModified" : "2018-04-22 23:01:09 \u002b0000 UTC",
      "url" : "https:\/\/pwaer.ink\/blog\/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F\/6-828-%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%E5%B7%A5%E7%A8%8B-lab3-user-environments\/",
      "keywords" : [ "OS", ]
  }
</script>
<title>6.828-操作系统工程-Lab3:User Environments</title>
  <meta property="og:title" content="6.828-操作系统工程-Lab3:User Environments" />
  <meta property="og:type" content="article" />
  <meta property="og:description" content="4月22日 - 5月2日
 PART A 这章的练习将会取实现一些基础的用户模式下的环境，也就是进程。在这章，创建一个用户环境，读取程序镜像并且运行。 这是关于这章节代码文件的介绍
inc/env.h Public definitions for user-mode environments trap.h Public definitions for trap handling syscall.h Public definitions for system calls from user environments to the kernel lib.h Public definitions for the user-mode support library kern/env.h Kernel-private definitions for user-mode environments env.c Kernel code implementing user-mode environments trap.h Kernel-private trap handling definitions trap.c Trap handling code trapentry.S Assembly-language trap handler entry-points syscall.h Kernel-private definitions for system call handling syscall." />
  <meta name="description" content="4月22日 - 5月2日
 PART A 这章的练习将会取实现一些基础的用户模式下的环境，也就是进程。在这章，创建一个用户环境，读取程序镜像并且运行。 这是关于这章节代码文件的介绍
inc/env.h Public definitions for user-mode environments trap.h Public definitions for trap handling syscall.h Public definitions for system calls from user environments to the kernel lib.h Public definitions for the user-mode support library kern/env.h Kernel-private definitions for user-mode environments env.c Kernel code implementing user-mode environments trap.h Kernel-private trap handling definitions trap.c Trap handling code trapentry.S Assembly-language trap handler entry-points syscall.h Kernel-private definitions for system call handling syscall." />
  <meta property="og:locale" content="en-us" />

  
    <style>body{font-family:bree serif,sans-serif;-webkit-font-smoothing:antialiased;margin:0 20px}article{max-width:800px;margin-left:auto;margin-right:auto}a{color:#000;text-decoration:none}a:hover{font-weight:600;text-decoration:underline}.post-ads{margin:50px 0}.markdown-body{font-size:18px;max-width:100%}.markdown-body a{text-decoration:underline;text-decoration-color:#000}.markdown-body pre{padding:16px;overflow:auto;border-radius:10px}.markdown-body code{padding:.2em .4em;font-size:85%;background-color:#f6f8fa;border-radius:6px}.markdown-body pre>code{padding:0;font-size:100%;background-color:inherit;border:0}.Chinese .markdown-body{line-height:200%}.site-date-catalog{font-size:2rem}.header-title{font-size:2rem;font-weight:700;margin-top:32px;font-family:bungee shade,sans-serif}.header-title a{text-decoration:none}.header-subtitle{color:#666}.header-items{margin:10px 0}.header-item{margin:0 5px}.header-line{width:100%;border-width:2px;border-color:#482936;border-style:solid none none none}.lang-switch{font-weight:600}#posts-list{min-height:600px}.posts-line{font-size:1.2rem;margin:12px 0}.posts-categories{font-size:.8rem;margin:auto;text-align:center}.posts-category{padding:3px 0;border:#000 2px solid;border-radius:5px}.site-footer{margin-top:50px}.site-footer-item{margin-right:12px}.post-content img{max-width:100%;display:block;margin-right:auto;margin-top:12px}.post-header{margin-bottom:50px}.post-title{font-size:2rem;font-weight:600}.post-tags{display:inline;font-weight:600;padding:2px 5px;margin-right:6px;border:#000 2px solid;border-radius:5px}.post-date{font-weight:800;font-style:italic}.post-author{float:right;font-weight:600}.page-content{min-height:60%}.post-content{margin-bottom:50px}.post-content p{hyphens:auto;line-height:1.8;text-justify:ideographic;margin-bottom:1em}.related-content{border-width:3px;border-style:solid;border-color:#000;padding:0 10px;margin-bottom:50px;margin-top:100px}.related-content li{margin:5px 0}.taxonomy-term{font-size:3rem}.gallery-img{text-align:center}.gallery-img span{text-align:center}.gallery-img-desc{font-size:.8em;font-weight:800}#disqus_thread{position:relative}#disqus_thread:after{content:"";display:block;height:55px;width:100%;position:absolute;bottom:0;background:#fff}@media screen and (max-width:600px){.header-title,.header-subtitle,.header-items{text-align:center}.posts-line{font-size:16px}.markdown-body{font-size:16px}.post-title{font-size:2rem}.post-content p{letter-spacing:.05em}}@media screen and (max-width:48em){.posts-category{display:none}}</style>
  
  
    <style>.container,.container-fluid{margin-right:auto;margin-left:auto}.container-fluid{padding-right:2rem;padding-left:2rem}.row{box-sizing:border-box;display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-flex:0;-ms-flex:0 1 auto;flex:0 1 auto;-webkit-box-orient:horizontal;-webkit-box-direction:normal;-ms-flex-direction:row;flex-direction:row;-ms-flex-wrap:wrap;flex-wrap:wrap;margin-right:-.5rem;margin-left:-.5rem}.row.reverse{-webkit-box-orient:horizontal;-webkit-box-direction:reverse;-ms-flex-direction:row-reverse;flex-direction:row-reverse}.col.reverse{-webkit-box-orient:vertical;-webkit-box-direction:reverse;-ms-flex-direction:column-reverse;flex-direction:column-reverse}.col-xs,.col-xs-1,.col-xs-10,.col-xs-11,.col-xs-12,.col-xs-2,.col-xs-3,.col-xs-4,.col-xs-5,.col-xs-6,.col-xs-7,.col-xs-8,.col-xs-9,.col-xs-offset-0,.col-xs-offset-1,.col-xs-offset-10,.col-xs-offset-11,.col-xs-offset-12,.col-xs-offset-2,.col-xs-offset-3,.col-xs-offset-4,.col-xs-offset-5,.col-xs-offset-6,.col-xs-offset-7,.col-xs-offset-8,.col-xs-offset-9{box-sizing:border-box;-webkit-box-flex:0;-ms-flex:0 0 auto;flex:0 0 auto;padding-right:.5rem;padding-left:.5rem}.col-xs{-webkit-box-flex:1;-ms-flex-positive:1;flex-grow:1;-ms-flex-preferred-size:0;flex-basis:0;max-width:100%}.col-xs-1{-ms-flex-preferred-size:8.33333333%;flex-basis:8.33333333%;max-width:8.33333333%}.col-xs-2{-ms-flex-preferred-size:16.66666667%;flex-basis:16.66666667%;max-width:16.66666667%}.col-xs-3{-ms-flex-preferred-size:25%;flex-basis:25%;max-width:25%}.col-xs-4{-ms-flex-preferred-size:33.33333333%;flex-basis:33.33333333%;max-width:33.33333333%}.col-xs-5{-ms-flex-preferred-size:41.66666667%;flex-basis:41.66666667%;max-width:41.66666667%}.col-xs-6{-ms-flex-preferred-size:50%;flex-basis:50%;max-width:50%}.col-xs-7{-ms-flex-preferred-size:58.33333333%;flex-basis:58.33333333%;max-width:58.33333333%}.col-xs-8{-ms-flex-preferred-size:66.66666667%;flex-basis:66.66666667%;max-width:66.66666667%}.col-xs-9{-ms-flex-preferred-size:75%;flex-basis:75%;max-width:75%}.col-xs-10{-ms-flex-preferred-size:83.33333333%;flex-basis:83.33333333%;max-width:83.33333333%}.col-xs-11{-ms-flex-preferred-size:91.66666667%;flex-basis:91.66666667%;max-width:91.66666667%}.col-xs-12{-ms-flex-preferred-size:100%;flex-basis:100%;max-width:100%}.col-xs-offset-0{margin-left:0}.col-xs-offset-1{margin-left:8.33333333%}.col-xs-offset-2{margin-left:16.66666667%}.col-xs-offset-3{margin-left:25%}.col-xs-offset-4{margin-left:33.33333333%}.col-xs-offset-5{margin-left:41.66666667%}.col-xs-offset-6{margin-left:50%}.col-xs-offset-7{margin-left:58.33333333%}.col-xs-offset-8{margin-left:66.66666667%}.col-xs-offset-9{margin-left:75%}.col-xs-offset-10{margin-left:83.33333333%}.col-xs-offset-11{margin-left:91.66666667%}.start-xs{-webkit-box-pack:start;-ms-flex-pack:start;justify-content:flex-start;text-align:start}.center-xs{-webkit-box-pack:center;-ms-flex-pack:center;justify-content:center;text-align:center}.end-xs{-webkit-box-pack:end;-ms-flex-pack:end;justify-content:flex-end;text-align:end}.top-xs{-webkit-box-align:start;-ms-flex-align:start;align-items:flex-start}.middle-xs{-webkit-box-align:center;-ms-flex-align:center;align-items:center}.bottom-xs{-webkit-box-align:end;-ms-flex-align:end;align-items:flex-end}.around-xs{-ms-flex-pack:distribute;justify-content:space-around}.between-xs{-webkit-box-pack:justify;-ms-flex-pack:justify;justify-content:space-between}.first-xs{-webkit-box-ordinal-group:0;-ms-flex-order:-1;order:-1}.last-xs{-webkit-box-ordinal-group:2;-ms-flex-order:1;order:1}@media only screen and (min-width:48em){.container{width:49rem}.col-sm,.col-sm-1,.col-sm-10,.col-sm-11,.col-sm-12,.col-sm-2,.col-sm-3,.col-sm-4,.col-sm-5,.col-sm-6,.col-sm-7,.col-sm-8,.col-sm-9,.col-sm-offset-0,.col-sm-offset-1,.col-sm-offset-10,.col-sm-offset-11,.col-sm-offset-12,.col-sm-offset-2,.col-sm-offset-3,.col-sm-offset-4,.col-sm-offset-5,.col-sm-offset-6,.col-sm-offset-7,.col-sm-offset-8,.col-sm-offset-9{box-sizing:border-box;-webkit-box-flex:0;-ms-flex:0 0 auto;flex:0 0 auto;padding-right:.5rem;padding-left:.5rem}.col-sm{-webkit-box-flex:1;-ms-flex-positive:1;flex-grow:1;-ms-flex-preferred-size:0;flex-basis:0;max-width:100%}.col-sm-1{-ms-flex-preferred-size:8.33333333%;flex-basis:8.33333333%;max-width:8.33333333%}.col-sm-2{-ms-flex-preferred-size:16.66666667%;flex-basis:16.66666667%;max-width:16.66666667%}.col-sm-3{-ms-flex-preferred-size:25%;flex-basis:25%;max-width:25%}.col-sm-4{-ms-flex-preferred-size:33.33333333%;flex-basis:33.33333333%;max-width:33.33333333%}.col-sm-5{-ms-flex-preferred-size:41.66666667%;flex-basis:41.66666667%;max-width:41.66666667%}.col-sm-6{-ms-flex-preferred-size:50%;flex-basis:50%;max-width:50%}.col-sm-7{-ms-flex-preferred-size:58.33333333%;flex-basis:58.33333333%;max-width:58.33333333%}.col-sm-8{-ms-flex-preferred-size:66.66666667%;flex-basis:66.66666667%;max-width:66.66666667%}.col-sm-9{-ms-flex-preferred-size:75%;flex-basis:75%;max-width:75%}.col-sm-10{-ms-flex-preferred-size:83.33333333%;flex-basis:83.33333333%;max-width:83.33333333%}.col-sm-11{-ms-flex-preferred-size:91.66666667%;flex-basis:91.66666667%;max-width:91.66666667%}.col-sm-12{-ms-flex-preferred-size:100%;flex-basis:100%;max-width:100%}.col-sm-offset-0{margin-left:0}.col-sm-offset-1{margin-left:8.33333333%}.col-sm-offset-2{margin-left:16.66666667%}.col-sm-offset-3{margin-left:25%}.col-sm-offset-4{margin-left:33.33333333%}.col-sm-offset-5{margin-left:41.66666667%}.col-sm-offset-6{margin-left:50%}.col-sm-offset-7{margin-left:58.33333333%}.col-sm-offset-8{margin-left:66.66666667%}.col-sm-offset-9{margin-left:75%}.col-sm-offset-10{margin-left:83.33333333%}.col-sm-offset-11{margin-left:91.66666667%}.start-sm{-webkit-box-pack:start;-ms-flex-pack:start;justify-content:flex-start;text-align:start}.center-sm{-webkit-box-pack:center;-ms-flex-pack:center;justify-content:center;text-align:center}.end-sm{-webkit-box-pack:end;-ms-flex-pack:end;justify-content:flex-end;text-align:end}.top-sm{-webkit-box-align:start;-ms-flex-align:start;align-items:flex-start}.middle-sm{-webkit-box-align:center;-ms-flex-align:center;align-items:center}.bottom-sm{-webkit-box-align:end;-ms-flex-align:end;align-items:flex-end}.around-sm{-ms-flex-pack:distribute;justify-content:space-around}.between-sm{-webkit-box-pack:justify;-ms-flex-pack:justify;justify-content:space-between}.first-sm{-webkit-box-ordinal-group:0;-ms-flex-order:-1;order:-1}.last-sm{-webkit-box-ordinal-group:2;-ms-flex-order:1;order:1}}@media only screen and (min-width:64em){.container{width:65rem}.col-md,.col-md-1,.col-md-10,.col-md-11,.col-md-12,.col-md-2,.col-md-3,.col-md-4,.col-md-5,.col-md-6,.col-md-7,.col-md-8,.col-md-9,.col-md-offset-0,.col-md-offset-1,.col-md-offset-10,.col-md-offset-11,.col-md-offset-12,.col-md-offset-2,.col-md-offset-3,.col-md-offset-4,.col-md-offset-5,.col-md-offset-6,.col-md-offset-7,.col-md-offset-8,.col-md-offset-9{box-sizing:border-box;-webkit-box-flex:0;-ms-flex:0 0 auto;flex:0 0 auto;padding-right:.5rem;padding-left:.5rem}.col-md{-webkit-box-flex:1;-ms-flex-positive:1;flex-grow:1;-ms-flex-preferred-size:0;flex-basis:0;max-width:100%}.col-md-1{-ms-flex-preferred-size:8.33333333%;flex-basis:8.33333333%;max-width:8.33333333%}.col-md-2{-ms-flex-preferred-size:16.66666667%;flex-basis:16.66666667%;max-width:16.66666667%}.col-md-3{-ms-flex-preferred-size:25%;flex-basis:25%;max-width:25%}.col-md-4{-ms-flex-preferred-size:33.33333333%;flex-basis:33.33333333%;max-width:33.33333333%}.col-md-5{-ms-flex-preferred-size:41.66666667%;flex-basis:41.66666667%;max-width:41.66666667%}.col-md-6{-ms-flex-preferred-size:50%;flex-basis:50%;max-width:50%}.col-md-7{-ms-flex-preferred-size:58.33333333%;flex-basis:58.33333333%;max-width:58.33333333%}.col-md-8{-ms-flex-preferred-size:66.66666667%;flex-basis:66.66666667%;max-width:66.66666667%}.col-md-9{-ms-flex-preferred-size:75%;flex-basis:75%;max-width:75%}.col-md-10{-ms-flex-preferred-size:83.33333333%;flex-basis:83.33333333%;max-width:83.33333333%}.col-md-11{-ms-flex-preferred-size:91.66666667%;flex-basis:91.66666667%;max-width:91.66666667%}.col-md-12{-ms-flex-preferred-size:100%;flex-basis:100%;max-width:100%}.col-md-offset-0{margin-left:0}.col-md-offset-1{margin-left:8.33333333%}.col-md-offset-2{margin-left:16.66666667%}.col-md-offset-3{margin-left:25%}.col-md-offset-4{margin-left:33.33333333%}.col-md-offset-5{margin-left:41.66666667%}.col-md-offset-6{margin-left:50%}.col-md-offset-7{margin-left:58.33333333%}.col-md-offset-8{margin-left:66.66666667%}.col-md-offset-9{margin-left:75%}.col-md-offset-10{margin-left:83.33333333%}.col-md-offset-11{margin-left:91.66666667%}.start-md{-webkit-box-pack:start;-ms-flex-pack:start;justify-content:flex-start;text-align:start}.center-md{-webkit-box-pack:center;-ms-flex-pack:center;justify-content:center;text-align:center}.end-md{-webkit-box-pack:end;-ms-flex-pack:end;justify-content:flex-end;text-align:end}.top-md{-webkit-box-align:start;-ms-flex-align:start;align-items:flex-start}.middle-md{-webkit-box-align:center;-ms-flex-align:center;align-items:center}.bottom-md{-webkit-box-align:end;-ms-flex-align:end;align-items:flex-end}.around-md{-ms-flex-pack:distribute;justify-content:space-around}.between-md{-webkit-box-pack:justify;-ms-flex-pack:justify;justify-content:space-between}.first-md{-webkit-box-ordinal-group:0;-ms-flex-order:-1;order:-1}.last-md{-webkit-box-ordinal-group:2;-ms-flex-order:1;order:1}}@media only screen and (min-width:75em){.container{width:76rem}.col-lg,.col-lg-1,.col-lg-10,.col-lg-11,.col-lg-12,.col-lg-2,.col-lg-3,.col-lg-4,.col-lg-5,.col-lg-6,.col-lg-7,.col-lg-8,.col-lg-9,.col-lg-offset-0,.col-lg-offset-1,.col-lg-offset-10,.col-lg-offset-11,.col-lg-offset-12,.col-lg-offset-2,.col-lg-offset-3,.col-lg-offset-4,.col-lg-offset-5,.col-lg-offset-6,.col-lg-offset-7,.col-lg-offset-8,.col-lg-offset-9{box-sizing:border-box;-webkit-box-flex:0;-ms-flex:0 0 auto;flex:0 0 auto;padding-right:.5rem;padding-left:.5rem}.col-lg{-webkit-box-flex:1;-ms-flex-positive:1;flex-grow:1;-ms-flex-preferred-size:0;flex-basis:0;max-width:100%}.col-lg-1{-ms-flex-preferred-size:8.33333333%;flex-basis:8.33333333%;max-width:8.33333333%}.col-lg-2{-ms-flex-preferred-size:16.66666667%;flex-basis:16.66666667%;max-width:16.66666667%}.col-lg-3{-ms-flex-preferred-size:25%;flex-basis:25%;max-width:25%}.col-lg-4{-ms-flex-preferred-size:33.33333333%;flex-basis:33.33333333%;max-width:33.33333333%}.col-lg-5{-ms-flex-preferred-size:41.66666667%;flex-basis:41.66666667%;max-width:41.66666667%}.col-lg-6{-ms-flex-preferred-size:50%;flex-basis:50%;max-width:50%}.col-lg-7{-ms-flex-preferred-size:58.33333333%;flex-basis:58.33333333%;max-width:58.33333333%}.col-lg-8{-ms-flex-preferred-size:66.66666667%;flex-basis:66.66666667%;max-width:66.66666667%}.col-lg-9{-ms-flex-preferred-size:75%;flex-basis:75%;max-width:75%}.col-lg-10{-ms-flex-preferred-size:83.33333333%;flex-basis:83.33333333%;max-width:83.33333333%}.col-lg-11{-ms-flex-preferred-size:91.66666667%;flex-basis:91.66666667%;max-width:91.66666667%}.col-lg-12{-ms-flex-preferred-size:100%;flex-basis:100%;max-width:100%}.col-lg-offset-0{margin-left:0}.col-lg-offset-1{margin-left:8.33333333%}.col-lg-offset-2{margin-left:16.66666667%}.col-lg-offset-3{margin-left:25%}.col-lg-offset-4{margin-left:33.33333333%}.col-lg-offset-5{margin-left:41.66666667%}.col-lg-offset-6{margin-left:50%}.col-lg-offset-7{margin-left:58.33333333%}.col-lg-offset-8{margin-left:66.66666667%}.col-lg-offset-9{margin-left:75%}.col-lg-offset-10{margin-left:83.33333333%}.col-lg-offset-11{margin-left:91.66666667%}.start-lg{-webkit-box-pack:start;-ms-flex-pack:start;justify-content:flex-start;text-align:start}.center-lg{-webkit-box-pack:center;-ms-flex-pack:center;justify-content:center;text-align:center}.end-lg{-webkit-box-pack:end;-ms-flex-pack:end;justify-content:flex-end;text-align:end}.top-lg{-webkit-box-align:start;-ms-flex-align:start;align-items:flex-start}.middle-lg{-webkit-box-align:center;-ms-flex-align:center;align-items:center}.bottom-lg{-webkit-box-align:end;-ms-flex-align:end;align-items:flex-end}.around-lg{-ms-flex-pack:distribute;justify-content:space-around}.between-lg{-webkit-box-pack:justify;-ms-flex-pack:justify;justify-content:space-between}.first-lg{-webkit-box-ordinal-group:0;-ms-flex-order:-1;order:-1}.last-lg{-webkit-box-ordinal-group:2;-ms-flex-order:1;order:1}}</style>
  

  

  <link href="/index.xml" rel="alternate" type="application/rss+xml"
    title="Pwaer&#39;s Blog">
  
  <link rel="preconnect" href="https://fonts.gstatic.com">
  <link href="https://fonts.googleapis.com/css?family=Bree+Serif|Bungee+Shade" rel="stylesheet">
  
  

  
  <script async src="https://www.googletagmanager.com/gtag/js?id=G-LGMCE8D1GT"></script><script>window.dataLayer = window.dataLayer || []; function gtag(){dataLayer.push(arguments);} gtag("js", new Date()); gtag("config", "G-LGMCE8D1GT");</script>
</head>


<body>
  <article class="post " id="article">
    <div class="row">
      <div class="col-xs-12">
        <div class="site-header">
          
<header>
  <div class="header-title">
    <a href="/"
      >Learning machine</a
    >
  </div>
  <div class="header-subtitle"></div>
</header>
<div class="row end-md center-xs header-items">
  
  <div class="header-item">
    <a href="/about">About Me</a>
  </div>
  
  <div class="header-item">
    <a href="/path">World</a>
  </div>
  
  <div class="header-item">
    <a href="https://github.com/fatwaer">Github</a>
  </div>
  
</div>
<div class="row end-xs">
   
</div>
<div class="header-line"></div>

        </div>
        <header class="post-header">
          <h1 class="post-title">6.828-操作系统工程-Lab3:User Environments</h1>
          
          <div class="row post-desc">
            <div class="col-xs-6">
              
              <time class="post-date" datetime="2018-04-22 23:01:09 UTC">
                22 Apr 2018
              </time>
              
            </div>
            <div class="col-xs-6">
              
              <div class="post-author">
                <a target="_blank" href="https//github.com/fatwaer">@pwaer</a>
              </div>
              
            </div>
          </div>
          
        </header>

        <div class="post-content markdown-body">
          
          <blockquote>
<p>4月22日 - 5月2日</p>
</blockquote>
<h1 id="part-a">PART A</h1>
<p>这章的练习将会取实现一些基础的用户模式下的环境，也就是进程。在这章，创建一个用户环境，读取程序镜像并且运行。
这是关于这章节代码文件的介绍</p>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:2;-o-tab-size:2;tab-size:2"><code class="language-fallback" data-lang="fallback">inc/env.h   Public definitions for user-mode environments
    trap.h  Public definitions for trap handling
    syscall.h   Public definitions for system calls from user environments to the kernel
    lib.h   Public definitions for the user-mode support library
kern/env.h   Kernel-private definitions for user-mode environments
    env.c   Kernel code implementing user-mode environments
    trap.h  Kernel-private trap handling definitions
    trap.c  Trap handling code
    trapentry.S Assembly-language trap handler entry-points
    syscall.h   Kernel-private definitions for system call handling
    syscall.c   System call implementation code
lib/Makefrag    Makefile fragment to build user-mode library, obj/lib/ libjos.a
    entry.S Assembly-language entry-point for user environments
    libmain.c   User-mode library setup code called from entry.S
    syscall.c   User-mode system call stub functions
    console.c   User-mode implementations of putchar and getchar, providing console I/O
    exit.c  User-mode implementation of exit
    panic.c User-mode implementation of panic
user/   *   Various test programs to check kernel lab 3 code

</code></pre></div><h1 id="内联汇编">内联汇编</h1>
<p>简单描述:</p>
<pre><code>__asm__(汇编语句模板: 输出部分: 输入部分: 破坏描述部分)
</code></pre>
<p><a href="http://www.ibiblio.org/gferg/ldp/GCC-Inline-Assembly-HOWTO.html">具体详情</a></p>
<h1 id="文件概述">文件概述</h1>
<p>在文件<code>inc/env.h</code>中定义了<code>Env</code>结构体，用来存储一些关于用户环境(进程)的结构体。</p>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:2;-o-tab-size:2;tab-size:2"><code class="language-C" data-lang="C"><span style="font-weight:bold">struct</span> Env {
    <span style="font-weight:bold">struct</span> Trapframe env_tf;    <span style="font-style:italic">// Saved registers
</span><span style="font-style:italic"></span>    <span style="font-weight:bold">struct</span> Env *env_link;       <span style="font-style:italic">// Next free Env
</span><span style="font-style:italic"></span>    envid_t env_id;         <span style="font-style:italic">// Unique environment identifier
</span><span style="font-style:italic"></span>    envid_t env_parent_id;      <span style="font-style:italic">// env_id of this env&#39;s parent
</span><span style="font-style:italic"></span>    <span style="font-weight:bold">enum</span> EnvType env_type;      <span style="font-style:italic">// Indicates special system environments
</span><span style="font-style:italic"></span>    <span style="">unsigned</span> env_status;        <span style="font-style:italic">// Status of the environment
</span><span style="font-style:italic"></span>    uint32_t env_runs;      <span style="font-style:italic">// Number of times environment has run
</span><span style="font-style:italic"></span>
    <span style="font-style:italic">// Address space
</span><span style="font-style:italic"></span>    pde_t *env_pgdir;       <span style="font-style:italic">// Kernel virtual address of page dir
</span><span style="font-style:italic"></span>};

</code></pre></div><p>在这个结构体中，<code>env_status</code>用来指示当前进程的状态，有以下几种定义在一个枚举类型里面。</p>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:2;-o-tab-size:2;tab-size:2"><code class="language-C" data-lang="C"><span style="font-weight:bold">enum</span> {
    ENV_FREE = 0,
    ENV_DYING,
    ENV_RUNNABLE,
    ENV_RUNNING,
    ENV_NOT_RUNNABLE
};

</code></pre></div><p>文件<code>kern/env.c</code>文件中，有三个文件域的定义。</p>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:2;-o-tab-size:2;tab-size:2"><code class="language-C" data-lang="C"><span style="font-weight:bold">struct</span> Env *envs = NULL;        <span style="font-style:italic">// All environments
</span><span style="font-style:italic"></span><span style="font-weight:bold">struct</span> Env *curenv = NULL;      <span style="font-style:italic">// The current env
</span><span style="font-style:italic"></span><span style="font-weight:bold">static</span> <span style="font-weight:bold">struct</span> Env *env_free_list;   <span style="font-style:italic">// Free environment list
</span><span style="font-style:italic"></span>
</code></pre></div><p><code>envs</code>指向保存所有<code>Env</code>结构体的内存页，并且指向虚拟内存<code>UTOP</code>。</p>
<p><code>curenv</code>是字面意思，指向当前执行的进程。</p>
<p><code>env_free_list</code>是一个链表表头，类似之前的<code>page_free_list</code>。</p>
<h1 id="练习1">练习1</h1>
<blockquote>
<p>分配NENV个Env结构体，并且用envs指针指向它们</p>
</blockquote>
<hr>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:2;-o-tab-size:2;tab-size:2"><code class="language-C" data-lang="C"><span style="font-style:italic">// Make &#39;envs&#39; point to an array of size &#39;NENV&#39; of &#39;struct Env&#39;.
</span><span style="font-style:italic"></span>envs = (<span style="font-weight:bold">struct</span> Env *)boot_alloc(NENV * <span style="font-weight:bold">sizeof</span>(<span style="font-weight:bold">struct</span> Env));
memset(envs, 0, NENV * <span style="font-weight:bold">sizeof</span>(<span style="font-weight:bold">struct</span> Env));

<span style="font-style:italic">// Map the &#39;envs&#39; array read-only by the user at linear address UENVS
</span><span style="font-style:italic">// (ie. perm = PTE_U | PTE_P).
</span><span style="font-style:italic"></span>boot_map_region(kern_pgdir, UENVS, PTSIZE, PADDR(envs), PTE_U | PTE_P);
</code></pre></div><h1 id="练习2">练习2</h1>
<blockquote>
<p>创建并且运行进程</p>
</blockquote>
<p>完成以下函数:</p>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:2;-o-tab-size:2;tab-size:2"><code class="language-fallback" data-lang="fallback">env_init()
    Initialize all of the Env structures in the envs array and add them to the
    env_free_list. Also calls env_init_percpu, which configures the
    segmentation hardware with separate segments for privilege level 0 (
    kernel) and privilege level 3 (user).
env_setup_vm()
    Allocate a page directory for a new environment and initialize the kernel
    portion of the new environment&#39;s address space.
region_alloc()
    Allocates and maps physical memory for an environment
load_icode()
    You will need to parse an ELF binary image, much like the boot loader
    already does, and load its contents into the user address space of a new
    environment.
env_create()
    Allocate an environment with env_alloc and call load_icode to load an ELF
    binary into it.
env_run()
    Start a given environment running in user mode.
    As you write these functions, you might find the new cprintf verb %e
    useful -- it prints a description corresponding to an error code. For
    example,

r = -E_NO_MEM;
panic(&#34;env_alloc: %e&#34;, r);
will panic with the message &#34;env_alloc: out of memory&#34;.
</code></pre></div><hr>
<h2 id="env_init">env_init()</h2>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:2;-o-tab-size:2;tab-size:2"><code class="language-C" data-lang="C"><span style="">void</span>
env_init(<span style="">void</span>)
{
    <span style="font-style:italic">// Set up envs array
</span><span style="font-style:italic"></span>    <span style="font-style:italic">// LAB 3: Your code here.
</span><span style="font-style:italic"></span>    <span style="">int</span> i;

    <span style="font-weight:bold">for</span> (i = NENV - 1; i &gt;= 0; i--) { <span style="font-style:italic">// reversal order
</span><span style="font-style:italic"></span>        envs[i].env_id = 0;
        envs[i].env_status = ENV_FREE;
        envs[i].env_link = env_free_list;
        env_free_list = &amp;envs[i];
    }

    <span style="font-style:italic">// Per-CPU part of the initialization
</span><span style="font-style:italic"></span>    env_init_percpu();

}
</code></pre></div><h2 id="env_setup_vm">env_setup_vm()</h2>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:2;-o-tab-size:2;tab-size:2"><code class="language-C" data-lang="C"><span style="font-weight:bold">static</span> <span style="">int</span>
env_setup_vm(<span style="font-weight:bold">struct</span> Env *e)
{
    <span style="">int</span> i;
    <span style="font-weight:bold">struct</span> PageInfo *p = NULL;

    <span style="font-style:italic">// Allocate a page for the page directory
</span><span style="font-style:italic"></span>    <span style="font-weight:bold">if</span> (!(p = page_alloc(ALLOC_ZERO)))
        <span style="font-weight:bold">return</span> -E_NO_MEM;


    <span style="font-style:italic">// LAB 3: Your code here.
</span><span style="font-style:italic"></span>    e-&gt;env_pgdir = (pte_t *)page2kva(p);
    p-&gt;pp_ref++;

    <span style="font-style:italic">/* copy structs to UTOP*/</span>
    memcpy(e-&gt;env_pgdir, kern_pgdir, PGSIZE);

    <span style="font-style:italic">// UVPT maps the env&#39;s own page table read-only.
</span><span style="font-style:italic"></span>    <span style="font-style:italic">// Permissions: kernel R, user R
</span><span style="font-style:italic"></span>    e-&gt;env_pgdir[PDX(UVPT)] = PADDR(e-&gt;env_pgdir) | PTE_P | PTE_U;

    <span style="font-weight:bold">return</span> 0;
}
</code></pre></div><h2 id="region_alloc">region_alloc()</h2>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:2;-o-tab-size:2;tab-size:2"><code class="language-C" data-lang="C"><span style="font-weight:bold">static</span> <span style="">void</span>
region_alloc(<span style="font-weight:bold">struct</span> Env *e, <span style="">void</span> *va, size_t len)
{
    <span style="font-style:italic">// LAB 3: Your code here.
</span><span style="font-style:italic"></span>    <span style="font-style:italic">// (But only if you need it for load_icode.)
</span><span style="font-style:italic"></span>    <span style="font-style:italic">//
</span><span style="font-style:italic"></span>    <span style="font-style:italic">// Hint: It is easier to use region_alloc if the caller can pass
</span><span style="font-style:italic"></span>    <span style="font-style:italic">//   &#39;va&#39; and &#39;len&#39; values that are not page-aligned.
</span><span style="font-style:italic"></span>    <span style="font-style:italic">//   You should round va down, and round (va + len) up.
</span><span style="font-style:italic"></span>    <span style="font-style:italic">//   (Watch out for corner-cases!)
</span><span style="font-style:italic"></span>    uintptr_t va_beg = ROUNDDOWN((uint32_t)va, PGSIZE);
    uintptr_t va_end = ROUNDUP((uint32_t)(va+len), PGSIZE);
    uintptr_t i;

    <span style="font-weight:bold">for</span> (i = va_beg; i &lt; va_end; i += PGSIZE) {  <span style="font-style:italic">/* maps each page to pa */</span>
        <span style="font-weight:bold">struct</span> PageInfo *p;
        <span style="font-weight:bold">if</span> (!(p = page_alloc(ALLOC_ZERO)))
            panic(<span style="font-style:italic">&#34;lack of free pages&#34;</span>);

        <span style="font-weight:bold">if</span> ((page_insert(e-&gt;env_pgdir, p, (<span style="">void</span> *)i, PTE_P | PTE_U | PTE_W)) == -E_NO_MEM)
            panic(<span style="font-style:italic">&#34;lack memmory&#34;</span>);

    }

}

</code></pre></div><h2 id="load_icode">load_icode()</h2>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:2;-o-tab-size:2;tab-size:2"><code class="language-C" data-lang="C"><span style="font-weight:bold">static</span> <span style="">void</span>
load_icode(<span style="font-weight:bold">struct</span> Env *e, uint8_t *binary)
{
    <span style="font-style:italic">// LAB 3: Your code here.
</span><span style="font-style:italic"></span>    <span style="font-style:italic">/* user mode */</span>
    lcr3(PADDR(e-&gt;env_pgdir));

    <span style="font-weight:bold">struct</span> Elf *elf = (<span style="font-weight:bold">struct</span> Elf *)binary;

    <span style="font-style:italic">/* check file format */</span>
    <span style="font-weight:bold">if</span> (elf-&gt;e_magic != ELF_MAGIC)
        panic(<span style="font-style:italic">&#34;load_icode() : format error &#34;</span>);

    <span style="font-weight:bold">if</span> (elf-&gt;e_entry == 0)
        panic(<span style="font-style:italic">&#34;load_icode() : ELF file loads failed&#34;</span>);

    e-&gt;env_tf.tf_eip = elf-&gt;e_entry;

    <span style="font-weight:bold">struct</span> Proghdr *ph, *eph;
    ph = (<span style="font-weight:bold">struct</span> Proghdr *)(binary + elf-&gt;e_phoff);
    eph = ph + elf-&gt;e_phnum;

    <span style="font-weight:bold">for</span> (; ph &lt; eph; ph++) {
        <span style="font-weight:bold">if</span> (ph-&gt;p_type == ELF_PROG_LOAD) {
        region_alloc(e, (<span style="">void</span> *)(ph-&gt;p_va), ph-&gt;p_memsz);

        memcpy((<span style="">void</span> *)ph-&gt;p_va, (<span style="">void</span> *)binary + ph-&gt;p_offset, (size_t)(ph-&gt;p_filesz));
        }
    }

    lcr3(PADDR(kern_pgdir));
    <span style="font-style:italic">// Now map one page for the program&#39;s initial stack
</span><span style="font-style:italic"></span>    <span style="font-style:italic">// at virtual address USTACKTOP - PGSIZE.
</span><span style="font-style:italic"></span>    <span style="font-style:italic">// LAB 3: Your code here.
</span><span style="font-style:italic"></span>    region_alloc(e, (<span style="">void</span> *)USTACKTOP-PGSIZE, PGSIZE);
}

</code></pre></div><h2 id="env_create">env_create()</h2>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:2;-o-tab-size:2;tab-size:2"><code class="language-C" data-lang="C"><span style="">void</span>
env_create(uint8_t *binary, <span style="font-weight:bold">enum</span> EnvType type)
{
    <span style="font-style:italic">// LAB 3: Your code here.
</span><span style="font-style:italic"></span>    <span style="font-weight:bold">struct</span> Env * env;
    <span style="font-weight:bold">if</span> (env_alloc(&amp;env, 0) &lt; 0)
        panic(<span style="font-style:italic">&#34;env_alloc error !&#34;</span>);


    load_icode(env, binary);
    env-&gt;env_type = type;
}

</code></pre></div><h2 id="env_run">env_run()</h2>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:2;-o-tab-size:2;tab-size:2"><code class="language-C" data-lang="C"><span style="">void</span>
env_run(<span style="font-weight:bold">struct</span> Env *e)
{
    <span style="font-weight:bold">if</span> (curenv != NULL &amp;&amp; curenv-&gt;env_status == ENV_RUNNING)
        curenv-&gt;env_status = ENV_RUNNABLE;

    curenv = e;

    curenv-&gt;env_status = ENV_RUNNING;
    curenv-&gt;env_runs++;
    lcr3(PADDR(curenv-&gt;env_pgdir));

    env_pop_tf(&amp;(curenv-&gt;env_tf));
    <span style="font-style:italic">// Hint: This function loads the new environment&#39;s state from
</span><span style="font-style:italic"></span>    <span style="font-style:italic">//  e-&gt;env_tf.  Go back through the code you wrote above
</span><span style="font-style:italic"></span>    <span style="font-style:italic">//  and make sure you have set the relevant parts of
</span><span style="font-style:italic"></span>    <span style="font-style:italic">//  e-&gt;env_tf to sensible values.
</span><span style="font-style:italic"></span>
    <span style="font-style:italic">// LAB 3: Your code here.
</span><span style="font-style:italic"></span>
    <span style="font-style:italic">//panic(&#34;env_run not yet implemented&#34;);
</span><span style="font-style:italic"></span>}

</code></pre></div><p>代码完成后应该还是会无限重启，因为，在执行完<code>env_pop_tf</code>的时候会去调用用户自己写的代码，但是会要用到从用户态到内核态的跳转，这部分代码并没有完成。</p>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:2;-o-tab-size:2;tab-size:2"><code class="language-fallback" data-lang="fallback">start (kern/entry.S)
i386_init (kern/init.c)
    cons_init
    mem_init
    env_init
    trap_init (still incomplete at this point)
    env_create
    env_run
    env_pop_tf
</code></pre></div><p>在qemu上运行这个内核，如果调用了成功执行到env_pop_tf的话，基本成功了。此时，内核会去执行一个<code>hello</code>的二进制文件，但是会用到系统调用和使用<code>int</code>中断指令。但是此时的JOS并没有完成用户空间到内核空间的跳转。CPU发现没有办法解决这个的办法，于是生成一个__二重错误异常__，然后继续发现还是没有办法去处理这个错误机制，于是引发__三重错误异常__，这时候，CPU就会要重置，使得整个系统重新启动。这就是现在看到的无限重启的行为。</p>
<p>用<code>make-qemu</code>和<code>make gdb</code>编译出内核，用<code>break env_pop_tf</code>在函数env_pop_tf处设置断点，单步执行，看能否能进入hello.asm中，地址在用户内存空间(0x08000000+)。然后在<code>obj/user/hello.asm</code>中找到<code>sys_cputs</code>中的<code>int $0x30</code>指令。如果成功执行到了这儿，说明之前的代码没有问题。</p>
<h1 id="练习3">练习3</h1>
<p>阅读<a href="https://pdos.csail.mit.edu/6.828/2017/readings/i386/c09.htm">Chapter 9, Exceptions and Interrupts</a></p>
<hr>
<p>中断是外部发给CPU的信号，而异常是CPU在自己处理命令时候出现的错误。
其中中断分为可屏蔽和不可屏蔽的。</p>
<p>异常也有三种(Faults/Traps/Aborts)，Faults异常是在执行这条指令之前就被指出的错误，但是如果在执行的过程中遇到了faults级的错误，CPU将会让机器保存状态，并且允许被修正重新执行。</p>
<p>第二种是Traps异常，是一种执行完后立即报告的异常，允许程序连续性执行，异常处理的返回地址就是trap指令后的那条。</p>
<p>第三种是Aborts异常，这种异常不报告异常发生的精确位置，也不运行程序继续往下执行。往往是发生了严重的错误，例如硬件错误和不合法的数值。</p>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:2;-o-tab-size:2;tab-size:2"><code class="language-fallback" data-lang="fallback">Table 9-1. Interrupt and Exception ID Assignments

Identifier   Description

0            Divide error
1            Debug exceptions
2            Nonmaskable interrupt
3            Breakpoint (one-byte INT 3 instruction)
4            Overflow (INTO instruction)
5            Bounds check (BOUND instruction)
6            Invalid opcode
7            Coprocessor not available
8            Double fault
9            (reserved)
10           Invalid TSS
11           Segment not present
12           Stack exception
13           General protection
14           Page fault
15           (reserved)
16           Coprecessor error
17-31        (reserved)
32-255       Available for external interrupts via INTR pin
</code></pre></div><hr>
<p><code>IF</code>(interrput-enable flag)是控制屏蔽外中断的标志位。当IF=0，中断会被屏蔽，IF=1，中断才会被接收。
CLI (Clear Interrupt-Enable Flag) and STI (Set Interrupt-Enable Flag) explicitly alter IF (bit 9 in the flag register).</p>
<p><code>IF</code>标志位被以下三种情况隐性影响：</p>
<ul>
<li><code>PUSHF</code>存储所有flag，包括IF。在栈中的IF，可以被修改。</li>
<li>任务切换时，<code>POP</code>和<code>IRET</code>读取flag寄存器，因此，这步操作能修改IF</li>
<li>中断通过interrupt gates(?)能自动重置IF，也就关闭外中断。</li>
</ul>
<hr>
<p>设置段地址的时候也会发生中断，影响程式的执行。通常设置栈区的段的时候通常使用以下这一对指令。</p>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:2;-o-tab-size:2;tab-size:2"><code class="language-asm" data-lang="asm">    MOV SS, AX
    MOV ESP, StackTop
</code></pre></div><p>如果这时候发生中断或者异常，SS已经被设置成了AX，而ESP的值还没被传达到，栈指针，SS:ESP在处理中断和异常的时候是不正常的，所以80386CPU在处理这两条指令的时候会屏蔽NMI, INTR, debug exceptions, and single-step traps这些中断。</p>
<h1 id="练习4">练习4</h1>
<blockquote>
<p>编辑trapentry.S和trap.c安装中断向量，宏TRAPHADNLER和TRAPHANDLER_NOEC可以帮助安装向量，中断向量被定义在inc/trap.h中。然后提供一共_alltraps去准备堆栈。在函数trap_init()中初始化idt中断向量数组，并且使用SETGATE去指向相关的函数。</p>
</blockquote>
<hr>
<p>为不同的中断生成入口，两个宏的差别在于是否有<a href="https://pdos.csail.mit.edu/6.828/2017/readings/i386/s09_10.htm">error code</a>。，如果有的话，硬件会自动将错误信息压栈。如果没有的话，宏<code>TRAPHANDLER_NOEC</code>会压入一个0值。</p>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:2;-o-tab-size:2;tab-size:2"><code class="language-asm" data-lang="asm">TRAPHANDLER_NOEC(divid_entry, T_DIVIDE)<span style="font-style:italic">;
</span><span style="font-style:italic"></span>TRAPHANDLER_NOEC(debug_entry, T_DEBUG)<span style="font-style:italic">;
</span><span style="font-style:italic"></span>TRAPHANDLER_NOEC(nmi_entry, T_NMI)<span style="font-style:italic">;
</span><span style="font-style:italic"></span>TRAPHANDLER_NOEC(brkpt_entry, T_BRKPT)<span style="font-style:italic">;
</span><span style="font-style:italic"></span>TRAPHANDLER_NOEC(oflow_entry, T_OFLOW)<span style="font-style:italic">;
</span><span style="font-style:italic"></span>TRAPHANDLER_NOEC(bound_entry, T_BOUND)<span style="font-style:italic">;
</span><span style="font-style:italic"></span>TRAPHANDLER_NOEC(illop_entry, T_ILLOP)<span style="font-style:italic">;
</span><span style="font-style:italic"></span>TRAPHANDLER_NOEC(device_entry, T_DEVICE)<span style="font-style:italic">;
</span><span style="font-style:italic"></span>TRAPHANDLER(dblflt_entry, T_DBLFLT)<span style="font-style:italic">;
</span><span style="font-style:italic"></span>TRAPHANDLER(tss_entry, T_TSS)<span style="font-style:italic">;
</span><span style="font-style:italic"></span>TRAPHANDLER(segnp_entry, T_SEGNP)<span style="font-style:italic">;
</span><span style="font-style:italic"></span>TRAPHANDLER(stack_entry, T_STACK)<span style="font-style:italic">;
</span><span style="font-style:italic"></span>TRAPHANDLER(gpflt_entry, T_GPFLT)<span style="font-style:italic">;
</span><span style="font-style:italic"></span>TRAPHANDLER(pgflt_entry, T_PGFLT)<span style="font-style:italic">;
</span><span style="font-style:italic"></span>TRAPHANDLER_NOEC(fperr_entry, T_FPERR)<span style="font-style:italic">;
</span><span style="font-style:italic"></span>TRAPHANDLER_NOEC(syscall_entry, T_SYSCALL)<span style="font-style:italic">;
</span></code></pre></div><p><code>_alltraps</code>将所有的寄存器状态保存，压栈。</p>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:2;-o-tab-size:2;tab-size:2"><code class="language-asm" data-lang="asm">_alltraps:
    pushl %ds
    pushl %es
    pushal

    mov $GD_KD, %ax
    mov %ax, %es
    mov %ax, %ds

    push %esp

    call trap
</code></pre></div><p><img src="/images/operating-system/6.828/lab3/stack.png" alt="stack.png"></p>
<p>根据练习提示，将段寄存器<code>es</code>和<code>ds</code>设置为GDT的kernel数据段，然后将esp压栈，调用trap。</p>
<p>这里直接调用trap就行，调用函数的参数已经在堆栈中，跳转到函数开始的地方就是一个普通的函数调用。</p>
<p>回顾之前的<code>Lab2</code>，在<code>env_run()</code>之前，会执行<code>trap_init()</code>，目的就是为了安装中断向量表。
<code>trap.c/trap_init()</code>中，将<code>idt</code>数组已知中断全部设置好，并将处理这个中断或者异常的handler安装到GDT中的<code>.text</code>域中，并且设置好权限。</p>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:2;-o-tab-size:2;tab-size:2"><code class="language-c" data-lang="c"><span style="">void</span>
trap_init(<span style="">void</span>)
{
    <span style="font-weight:bold">extern</span> <span style="font-weight:bold">struct</span> Segdesc gdt[];

    <span style="font-style:italic">// LAB 3: Your code here.
</span><span style="font-style:italic"></span>    <span style="">void</span> divid_entry();
    <span style="">void</span> debug_entry();
    <span style="">void</span> nmi_entry();
    <span style="">void</span> brkpt_entry();
    <span style="">void</span> oflow_entry();
    <span style="">void</span> bound_entry();
    <span style="">void</span> illop_entry();
    <span style="">void</span> device_entry();
    <span style="">void</span> dblflt_entry();
    <span style="">void</span> tss_entry();
    <span style="">void</span> segnp_entry();
    <span style="">void</span> stack_entry();
    <span style="">void</span> gpflt_entry();
    <span style="">void</span> pgflt_entry();
    <span style="">void</span> fperr_entry();
    <span style="">void</span> syscall_entry();

    SETGATE(idt[T_DIVIDE], 1, GD_KT, divid_entry, 0);
    SETGATE(idt[T_DEBUG], 1, GD_KT, debug_entry, 3);
    SETGATE(idt[T_NMI], 1, GD_KT, nmi_entry, 0);
    SETGATE(idt[T_BRKPT], 1, GD_KT, brkpt_entry, 3);
    SETGATE(idt[T_OFLOW], 1, GD_KT, oflow_entry, 0);
    SETGATE(idt[T_BOUND], 1, GD_KT, bound_entry, 0);
    SETGATE(idt[T_ILLOP], 1, GD_KT, illop_entry, 0);
    SETGATE(idt[T_DEVICE], 1, GD_KT, device_entry, 0);
    SETGATE(idt[T_DBLFLT], 1, GD_KT, dblflt_entry, 0);
    SETGATE(idt[T_TSS], 1, GD_KT, tss_entry, 0);
    SETGATE(idt[T_SEGNP], 1, GD_KT, segnp_entry, 0);
    SETGATE(idt[T_STACK], 1, GD_KT, stack_entry, 0);
    SETGATE(idt[T_GPFLT], 1, GD_KT, gpflt_entry, 0);
    SETGATE(idt[T_PGFLT], 1, GD_KT, pgflt_entry, 0);
    SETGATE(idt[T_FPERR], 1, GD_KT, fperr_entry, 0);
    SETGATE(idt[T_SYSCALL], 1, GD_KT, syscall_entry, 3);

    <span style="font-style:italic">// Per-CPU setup
</span><span style="font-style:italic"></span>    trap_init_percpu();
}
</code></pre></div><blockquote>
<p>Q1:What is the purpose of having an individual handler function for each exception/interrupt? (i.e., if all exceptions/interrupts were delivered to the same handler, what feature that exists in the current implementation could not be provided?)</p>
</blockquote>
<p>不同的权限组应该要有不同的解决办法。</p>
<blockquote>
<p>Q2:Did you have to do anything to make the user/softint program behave correctly? The grade script expects it to produce a general protection fault (trap 13), but softint&rsquo;s code says int 14. Why should this produce interrupt vector 13? What happens if the kernel actually allows softint&rsquo;s int 14 instruction to invoke the kernel&rsquo;s page fault handler (which is interrupt vector 14)?</p>
</blockquote>
<p><code>user/softint</code>用户程序中就只有一句:</p>
<pre><code>asm volatile (&quot;int $14&quot;);
</code></pre>
<p>用来产生<code>page fault</code>，但是这是用户程序产生的。一般产生页错误，查看page fault的处理办法<code>page_fault_handler()</code>中<code>env_destroy(curenv);</code>会将这个用户环境销毁。一般用户应该没有这样的权限。</p>
<p>所以对于权限不够的用户，应该产生<code>General protection fault </code>。</p>
<p>This concludes part A of the lab.</p>
<hr>
<h1 id="part-b">PART B</h1>
<p>这一部分解决__Page Faults, Breakpoints Exceptions, System Calls__</p>
<p><code>_alltraps</code>会调用traps
<code>traps</code>可以分为四个部分</p>
<ol>
<li>关闭中断</li>
</ol>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:2;-o-tab-size:2;tab-size:2"><code class="language-C" data-lang="C">    <span style="font-weight:bold">asm</span> volatile(<span style="font-style:italic">&#34;cld&#34;</span> ::: <span style="font-style:italic">&#34;cc&#34;</span>);
    assert(!(read_eflags() &amp; FL_IF));
</code></pre></div><ol start="2">
<li>如果是用户模式，复制一份用户栈。</li>
</ol>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:2;-o-tab-size:2;tab-size:2"><code class="language-fallback" data-lang="fallback">    if ((tf-&gt;tf_cs &amp; 3) == 3) {
        assert(curenv);
        curenv-&gt;env_tf = *tf;
        tf = &amp;curenv-&gt;env_tf;
    }
    last_tf = tf;
</code></pre></div><ol start="3">
<li>处理中断</li>
</ol>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:2;-o-tab-size:2;tab-size:2"><code class="language-fallback" data-lang="fallback">    trap_dispatch(tf);
</code></pre></div><ol start="4">
<li>如果这个用户环境未被销毁，那么继续执行。</li>
</ol>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:2;-o-tab-size:2;tab-size:2"><code class="language-fallback" data-lang="fallback">    assert(curenv &amp;&amp; curenv-&gt;env_status == ENV_RUNNING);
    env_run(curenv);
</code></pre></div><hr>
<h1 id="练习5--6">练习5 , 6</h1>
<blockquote>
<p>让14号中断调用page_fault_handler()函数</p>
</blockquote>
<blockquote>
<p>breakpoint异常，3号中断通常是用来给调试器使用，它允许程序代码临时性地代替程序指令。在JOS中使用monitor()来执行处理异常。</p>
</blockquote>
<hr>
<p><code>page_fault_handler</code>函数中通过<code>fault_va = rcr2()</code>获取页出错的虚拟地址。</p>
<p>这两个练习都是在<code>trap_dispatch</code>中修改，代码如下。</p>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:2;-o-tab-size:2;tab-size:2"><code class="language-C" data-lang="C">    <span style="font-style:italic">// Handle page fault exceptions.
</span><span style="font-style:italic"></span>    <span style="font-weight:bold">if</span> (tf-&gt;tf_trapno == T_PGFLT) {
        page_fault_handler(tf);
        <span style="font-weight:bold">return</span> ;
    }

    <span style="font-style:italic">// after int 3 interrupt , this function
</span><span style="font-style:italic"></span>    <span style="font-style:italic">// uses panic() to output debugger infomations.
</span><span style="font-style:italic"></span>    <span style="font-weight:bold">if</span> (tf-&gt;tf_trapno == T_BRKPT) {
        monitor(tf);
        <span style="font-weight:bold">return</span> ;
    }
</code></pre></div><h1 id="challenge">Challenge</h1>
<p>//想做做不出来&hellip;留个思路</p>
<ol>
<li>monitor中执行函数</li>
<li>激活tf栈中的eflags中TF位，开启单步调试</li>
<li>然后使用<code>IRET</code>返回中断，弹栈。
<a href="https://pdos.csail.mit.edu/6.828/2017/labs/lab3/#Exercise-6">optional</a></li>
</ol>
<blockquote>
<p>Q1:The break point test case will either generate a break point exception or a general protection fault depending on how you initialized the break point entry in the IDT (i.e., your call to SETGATE from trap_init). Why? How do you need to set it up in order to get the breakpoint exception to work as specified above and what incorrect setup would cause it to trigger a general protection fault?</p>
</blockquote>
<p><code>interrupt gate</code>中<code>DPL</code>影响这两种情况，当调用的时候，<code>eflags</code>中的<code>CPL</code>的值大于DPL的时候会产生<code>general protection fault</code>，因为特权等级不够。</p>
<blockquote>
<p>Q2:What do you think is the point of these mechanisms, particularly in light of what the user/softint test program does?</p>
</blockquote>
<p>用户不能产生14中断，特权级不够。</p>
<h1 id="练习7">练习7</h1>
<blockquote>
<p>完成系统调用</p>
</blockquote>
<hr>
<p>用户通过系统调用进入内核态，并且保存用户的状态信息，内核执行合适的处理代码，然后恢复到用户态，当然，也需要确定调用是从内核态到用户态还是内核自身调用系统函数。
JOS中系统调用的中断号是0x30，不会由计算机硬件产生，所以需要写好相应的调用代码。</p>
<p>应用程序将会把系统调用的编号和系统调用的参数保存在寄存器中。system call number将会保存在<code>%eax</code>中，接下来最多五个参数分别保存在 <code>%edx</code>, <code>%ecx</code>, <code>%ebx</code>, <code>%edi</code>, <code>%esi</code>中。system call函数已经写好在了文件<code>lib/syscall.c</code>中。</p>
<h2 id="trap_init">trap_init()</h2>
<p>在<code>trap_init()</code>中添加相应的handler:</p>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:2;-o-tab-size:2;tab-size:2"><code class="language-C" data-lang="C">    <span style="">void</span> syscall_entry();

    ...

    ...

    SETGATE(idt[T_SYSCALL], 1, GD_KT, syscall_entry, 3);

</code></pre></div><h2 id="trap_dispatch">trap_dispatch()</h2>
<p>然后在<code>trap_dispatch()</code>中为中断添加调用：</p>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:2;-o-tab-size:2;tab-size:2"><code class="language-C" data-lang="C">    <span style="font-style:italic">// system call
</span><span style="font-style:italic"></span>    <span style="font-weight:bold">if</span> (tf-&gt;tf_trapno == T_SYSCALL) {
        tf-&gt;tf_regs.reg_eax = syscall(
                tf-&gt;tf_regs.reg_eax, tf-&gt;tf_regs.reg_edx,
                tf-&gt;tf_regs.reg_ecx, tf-&gt;tf_regs.reg_ebx,
                tf-&gt;tf_regs.reg_edi, tf-&gt;tf_regs.reg_esi);
        <span style="font-weight:bold">return</span> ;
    }

</code></pre></div><hr>
<h2 id="syscall">syscall()</h2>
<p>利用<code>lib/syscall.c</code>中的syscall进行转移到真正处理通用系统调用的文件中，根据<code>inc/syscall.h</code>中的enum定义分发到相应的系统调用的处理函数去。</p>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:2;-o-tab-size:2;tab-size:2"><code class="language-C" data-lang="C"><span style="font-style:italic">// Dispatches to the correct kernel function, passing the arguments.
</span><span style="font-style:italic"></span>int32_t
syscall(uint32_t syscallno, uint32_t a1, uint32_t a2, uint32_t a3, uint32_t a4, uint32_t a5)
{
    <span style="font-style:italic">// Call the function corresponding to the &#39;syscallno&#39; parameter.
</span><span style="font-style:italic"></span>    <span style="font-style:italic">// Return any appropriate return value.
</span><span style="font-style:italic"></span>    <span style="font-style:italic">// LAB 3: Your code here.
</span><span style="font-style:italic"></span>
    cprintf(<span style="font-style:italic">&#34;call number:%d  </span><span style="font-weight:bold;font-style:italic">\n</span><span style="font-style:italic">&#34;</span>, syscallno);
    <span style="font-weight:bold">switch</span> (syscallno) {

    <span style="font-weight:bold">case</span> SYS_cputs:
        sys_cputs((<span style="">char</span> *)a1, a2);
        <span style="font-weight:bold">return</span> 0;

    <span style="font-weight:bold">case</span> SYS_cgetc:
        <span style="font-weight:bold">return</span> sys_cgetc();

    <span style="font-weight:bold">case</span> SYS_getenvid:
        <span style="font-weight:bold">return</span> sys_getenvid();

    <span style="font-weight:bold">case</span> SYS_env_destroy:
        <span style="font-weight:bold">return</span> sys_env_destroy(a1);

    <span style="font-weight:bold">default</span>:
        <span style="font-weight:bold">return</span> -E_INVAL;
    }
}
</code></pre></div><p>完成这里，利用<code>make run-hello</code>检测自己的系统调用是否成功。</p>
<h1 id="练习8">练习8</h1>
<p>用户程序从这里开始执行，确认好相关信息后跳转到 <code>libmain</code>执行。</p>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:2;-o-tab-size:2;tab-size:2"><code class="language-asm" data-lang="asm">.text
.globl _start
_start:
    <span style="">//</span> See if we were started with arguments on the stack
    cmpl $USTACKTOP, %esp
    jne args_exist

    <span style="">//</span> If not, push dummy argc<span style="">/</span>argv arguments.
    <span style="">//</span> This happens when we are loaded by the kernel,
    <span style="">//</span> because the kernel does not know about passing arguments.
    pushl $0
    pushl $0

args_exist:
    call libmain
<span style="">1:</span>  jmp 1b
</code></pre></div><p>将<code>libmain()</code>改成</p>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:2;-o-tab-size:2;tab-size:2"><code class="language-C" data-lang="C">    <span style="font-style:italic">// LAB 3: Your code here.
</span><span style="font-style:italic"></span>    thisenv = envs + ENVX(sys_getenvid());
</code></pre></div><p>ENVX宏定义在<code>env.h</code>文件中。
然后接下来调用用户程序<code>umain</code>和<code>exit()</code>，<code>umain</code>就相当于平时执行的C程序中main函数，<code>exit()</code>执行系统调用函数<code>sys_env_destroy()</code>。</p>
<h1 id="练习910">练习9/10</h1>
<p>修改kern/trap.c,当内核页错误的时候调用<code>panic</code>，检查tf_cs的低位。
阅读kern/pmap.c中user_mem_assert函数，并且实现user_mem_check函数。
修改kern/syscall.c，检查系统调用的参数。
修改kern/kdebug.c中的debuginfo_eip，调用user_mem_check检查<code>usd</code>,<code>stabs</code>,<code>stabstr</code>。</p>
<hr>
<p>内存保护是操作系统的一个决定性的特性，确保程序的BUG不会影响到其他程序和操作系统自己。</p>
<p>操作系统通常依赖硬件去实现内存保护，当程序使用一个非法的内存地址或者对指定的虚拟地址没有访问权，处理器会中断程序指令并且产生一个fault级别异常，然后陷入内核态，去处理这个操作。如果这个错误可以修复，内核通过代码修复，然后让程序继续运行，否则，摧毁该程序。</p>
<p>一种常见的可以修复的错误就是栈增长，大多数系统初始化一个进程通常只会分配一个stack页，当程序使用这个分配好的栈的更下层的时候，内核将会自动分配更多的空间，当然会有一个分配的最大值。</p>
<p>大多数系统调用接口让用户程序传递一个指针给系统内核，这个指针指向一个用户内存空间的一个可读可写的缓冲区。系统内核通过解引用这个指针和用户程序进行交互，但是存在以下两个问题。</p>
<ol>
<li>
<p>内核态出现页错误比在用户态出现页错误可能更加严重，如果内核在操作自己的数据结构的时候发生了页错误，这是一个内核BUG，解决错误的handler此时应该<code>panic</code>。但是当内核解引用用户程序传递过来的指针的时候，内核需要确认这个指针的是属于该用户程序的。</p>
</li>
<li>
<p>内核的权限通常高于用户程序，用户可能会传递一个内核可以读取，但是该程序不能读取的内存地址。内核需要非常仔细的检查这类指针，因为这样可能会造成隐私信息泄露和破坏内核完整性。</p>
</li>
</ol>
<h2 id="page_fault_handler">page_fault_handler()</h2>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:2;-o-tab-size:2;tab-size:2"><code class="language-C" data-lang="C">    <span style="font-style:italic">// LAB 3: Your code here.(1)
</span><span style="font-style:italic"></span>    <span style="font-weight:bold">if</span> ((tf-&gt;tf_cs &amp; 3) == 0)
        panic(<span style="font-style:italic">&#34;kernel page fault&#34;</span>);

</code></pre></div><p>在8086模式下，寄存器CS,DS,ES等被称作段偏移，但是在保护模式下，CS,DS,ES等寄存器被用作段选择子，在<code>GDT</code>中选定相应的段，根据全局描述符中的信息，程序只能在相应的内存段中运行，读取，写入，否则会发生中断或者异常。</p>
<h2 id="user_mem_check"><code>user_mem_check</code></h2>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:2;-o-tab-size:2;tab-size:2"><code class="language-C" data-lang="C"><span style="">int</span>
user_mem_check(<span style="font-weight:bold">struct</span> Env *env, <span style="font-weight:bold">const</span> <span style="">void</span> *va, size_t len, <span style="">int</span> perm)
{
    <span style="font-style:italic">// LAB 3: Your code here.
</span><span style="font-style:italic"></span>    <span style="font-weight:bold">if</span> ((uintptr_t)va &gt;= ULIM)  {
        user_mem_check_addr = (uintptr_t) va;
        <span style="font-weight:bold">return</span> -E_FAULT;
    }


    uintptr_t beg = ROUNDDOWN((uint32_t)va, PGSIZE);
    uintptr_t end = ROUNDUP((uintptr_t)va+len, PGSIZE);
    uintptr_t i;
    pte_t *phaddr_entry;

    <span style="font-weight:bold">for</span> (i = beg; i != end; i += PGSIZE) {
        phaddr_entry = pgdir_walk(env-&gt;env_pgdir, (<span style="">void</span> *)i, false);
        <span style="font-weight:bold">if</span> ( phaddr_entry == NULL || !(*phaddr_entry &amp; PTE_P)  || (*phaddr_entry &amp; perm ) != perm) {
            user_mem_check_addr = i &lt; (uintptr_t)va ? (uintptr_t)va : i;
            cprintf(<span style="font-style:italic">&#34;%x</span><span style="font-weight:bold;font-style:italic">\n</span><span style="font-style:italic">&#34;</span>, user_mem_check_addr);
            <span style="font-weight:bold">return</span> -E_FAULT;
        }
    }
    <span style="font-weight:bold">return</span> 0;
}

</code></pre></div><p><code>BUG</code> ： 这里在调用pgdir_walk的时候把env-&gt;env_pgdir写成了kern_pgdir，用户一般都不会有内核的地址空间的读写权限，导致<code>make run</code>相关程序的时候发生失败。</p>
<h2 id="sys_cputs">sys_cputs()</h2>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:2;-o-tab-size:2;tab-size:2"><code class="language-C" data-lang="C">    <span style="font-style:italic">// Check that the user has permission to read memory [s, s+len).
</span><span style="font-style:italic"></span>    <span style="font-style:italic">// Destroy the environment if not.
</span><span style="font-style:italic"></span>    <span style="font-style:italic">// LAB 3: Your code here.
</span><span style="font-style:italic"></span>    user_mem_assert(curenv, s, len, PTE_U);
</code></pre></div><h2 id="debuginfo_eip">debuginfo_eip()</h2>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:2;-o-tab-size:2;tab-size:2"><code class="language-fallback" data-lang="fallback">    // Make sure this memory is valid.
    // Return -1 if it is not.  Hint: Call user_mem_check.
    // LAB 3: Your code here.
    if (user_mem_check(curenv, usd, sizeof(struct UserStabData), PTE_U) &lt; 0)
        return -1;

    stabs = usd-&gt;stabs;
    stab_end = usd-&gt;stab_end;
    stabstr = usd-&gt;stabstr;
    stabstr_end = usd-&gt;stabstr_end;

    // Make sure the STABS and string table memory is valid.
    // LAB 3: Your code here.
    if (user_mem_check(curenv, stabs, stab_end - stabs, PTE_U) &lt; 0)
        return -1;
    if (user_mem_check(curenv, stabstr, stabstr_end - stabstr, PTE_U) &lt; 0)
        return -1;
</code></pre></div><blockquote>
<p>Q: run user/breakpoint, you should be able to run backtrace from the kernel monitor and see the backtrace traverse into lib/libmain.c before the kernel panics with a page fault. What causes this page fault? You don&rsquo;t need to fix it, but you should understand why it happens.</p>
</blockquote>
<p>// todo</p>
<h1 id="make-grade">make grade</h1>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:2;-o-tab-size:2;tab-size:2"><code class="language-bash" data-lang="bash">
make[1]: Leaving directory <span style="font-style:italic">&#39;/home/moonlight/lab&#39;</span>
divzero: OK (1.3s)
softint: OK (1.0s)
badsegment: OK (1.1s)
Part A score: 30/30

faultread: OK (0.9s)
faultreadkernel: OK (1.9s)
faultwrite: OK (1.1s)
faultwritekernel: OK (1.7s)
breakpoint: OK (1.4s)
testbss: OK (1.7s)
hello: OK (2.2s)
buggyhello: OK (2.0s)
buggyhello2: OK (2.1s)
evilhello: OK (1.7s)
Part B score: 50/50

Score: 80/80

</code></pre></div><p>This completes the lab.</p>

        </div>

        <div class="row middle-xs">
          <div class="col-xs-12">
            
            <div class="post-tags">
              <a href="/tags/os/">
                OS
              </a>
            </div>
            
          </div>
        </div>
        
          <div class="row">
            <div class="col-xs-12">
              
            </div>
          </div>

          

<div class="related-content">
  <h3>Related Posts</h3>
  <ul>
    
    <li><a href="/blog/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/6-828-%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%E5%B7%A5%E7%A8%8B-lab2-memory-management/">6.828-操作系统工程-Lab2:Memory Management</a></li>
    
  </ul>
</div>



          
          
          <div style="height: 50px;"></div>
          
          <div class="post-comments">
            <div id="disqus_thread"></div>
<script>
  window.addEventListener("load", () => {
    (function() {
      
      var d = document,
        s = d.createElement("script");
      s.src = "https://fatwaer.disqus.com/embed.js";
      s.setAttribute("data-timestamp", +new Date());
      (d.head || d.body).appendChild(s);
    })();
  });
</script>
<noscript
  >Please enable JavaScript to view the
  <a href="https://disqus.com/?ref_noscript"
    >comments powered by Disqus.</a
  ></noscript
>

          </div>
          
        

        <div class="site-footer">
  
  
</div>

      </div>
    </div>
  </article>

  

<script>
  
  
    
    
  
</script>

  

</body>

</html>